<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{item.name}}</title>
	<link rel="stylesheet" href="itemDetail.css">
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
	
</head>
<body>
	<main class="container">

	<!-- Left Column / Headphones Image -->
	<div class="left-column">
		<img data-image="black" src="{{item.img}}" alt="">

	</div>


	<!-- Right Column -->
	<div class="right-column">

		<!-- Product Description -->
		<div class="product-description">
			<span><a href='/'> HOME </a></span>
			<h1>{{item.name}}</h1>
			<p>{{item.explanation}}</p>
		</div>

			<!-- Product Configuration -->
		<form action="#" method="POST" id="form">
			<div class="product-configuration">

				<!-- Cable Configuration -->
				<div class="cable-config">
					<span>Purchase Percent</span>
					<div class="textbox">
						<input type="number" min='1', max='{{item.percent}}' id="percent_input" onkeyup='getPercent()' name="purchasePercent" >
					</div>
				</div>
			</div>

			<!-- Product Pricing -->
			<p id='price' style="display:none;">{{item.price}}</p>
			<div class="product-price">
				<input href="#" type="submit" class="cart-btn" onclick='requestPay()' value ="buy">
			</div>
		</form>
		<script>
			const form = document.getElementById('form');

			

			form.addEventListener('submit', async(e) => {
				e.preventDefault();
				const totalPrice = document.getElementsByClassName('totalPrice')[0].innerHTML;
				console.log(totalPrice.substring(0, totalPrice.length - 1))
				const itemId = window.location.pathname.substring(6);
				let formData = new FormData(form);
				formData.append('itemId', itemId);
				formData.append('price', totalPrice);
				
				var object = {}
				formData.forEach(function(value,key){
					object[key]=value
				})

				let data = JSON.stringify(object)
				console.log(data)
				const response = await fetch("/item/order", {
					method: "POST",
					headers: {
						'Content-Type': 'application/json'
					},
					body: data
				});
				
			});
		</script>
	</div>
	<script src='itemDetail.js'></script>
	<script src="payment.js"></script>
	</main>
</body>	